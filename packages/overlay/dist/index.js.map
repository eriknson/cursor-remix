{"version":3,"sources":["../src/runtime/FlowOverlay.tsx","../src/runtime/cn.ts","../src/runtime/constants.ts"],"sourcesContent":["'use client';\n\nimport {\n  type CSSProperties,\n  type ChangeEvent,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n  type KeyboardEvent as ReactKeyboardEvent,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { ArrowUp, Square, Command } from \"lucide-react\";\n\nimport { cn } from \"./cn\";\nimport { DEFAULT_MODEL_OPTIONS, DEFAULT_STATUS_SEQUENCE } from \"./constants\";\nimport type {\n  ModelOption,\n  SelectionPayload,\n  ShipflowOverlayConfig,\n  StatusAddonMode,\n  StatusSequence,\n  StreamEvent,\n} from \"./types\";\nimport { loadReactGrabRuntime } from \"./loadReactGrabRuntime\";\nimport {\n  registerClipboardInterceptor,\n  type ClipboardInterceptorOptions,\n} from \"./registerClipboardInterceptor\";\n\nconst HIGHLIGHT_QUERY = \"[data-react-grab-chat-highlighted='true']\";\nconst EVENT_OPEN = \"react-grab-chat:open\";\nconst EVENT_CLOSE = \"react-grab-chat:close\";\nconst EVENT_UNDO = \"react-grab-chat:undo\";\n\nconst DEFAULT_CONFIG: ShipflowOverlayConfig = {\n  endpoint: \"/api/shipflow/overlay\",\n  models: DEFAULT_MODEL_OPTIONS,\n  statusSequence: DEFAULT_STATUS_SEQUENCE,\n};\n\ntype ChatState = SelectionPayload & {\n  instruction: string;\n  status: \"idle\" | \"submitting\" | \"success\" | \"error\";\n  error?: string;\n  serverMessage?: string;\n  model: string;\n  statusPhase: number;\n  statusAddonMode: StatusAddonMode;\n  statusLabel: string | null;\n  statusContext: string | null;\n  useTypewriter: boolean;\n  summary?: string;\n};\n\nconst DEFAULT_BUBBLE_STYLE: CSSProperties = {\n  top: \"20%\",\n  left: \"50%\",\n  transform: \"translate(-50%, -50%)\",\n};\n\nconst VIEWPORT_MARGIN = 12;\nconst ANCHOR_GAP = 24;\nconst POINTER_HORIZONTAL_GAP = 16;\nconst POINTER_VERTICAL_OFFSET = 12;\n\nconst createInitialState = (\n  models: readonly ModelOption[],\n  statusSequence: StatusSequence,\n): ChatState => ({\n  htmlFrame: null,\n  codeLocation: null,\n  filePath: null,\n  clipboardData: \"\",\n  pointer: null,\n  boundingRect: null,\n  instruction: \"\",\n  status: \"idle\",\n  serverMessage: undefined,\n  error: undefined,\n  model: models[0]?.value ?? \"\",\n  statusPhase: 0,\n  statusAddonMode: \"idle\",\n  statusLabel: statusSequence[0] ?? null,\n  statusContext: null,\n  useTypewriter: true,\n  summary: undefined,\n});\n\nexport type FlowOverlayProps = Partial<ShipflowOverlayConfig> & {\n  enableClipboardInterceptor?: boolean;\n  clipboardOptions?: ClipboardInterceptorOptions;\n};\n\nfunction CursorIcon({ className }: { className?: string }) {\n  return (\n    <svg\n      viewBox=\"0 0 466.73 533.32\"\n      className={className}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      shapeRendering=\"geometricPrecision\"\n    >\n      <path fill=\"#72716d\" d=\"M233.37,266.66l231.16,133.46c-1.42,2.46-3.48,4.56-6.03,6.03l-216.06,124.74c-5.61,3.24-12.53,3.24-18.14,0L8.24,406.15c-2.55-1.47-4.61-3.57-6.03-6.03l231.16-133.46h0Z\" />\n      <path fill=\"#55544f\" d=\"M233.37,0v266.66L2.21,400.12c-1.42-2.46-2.21-5.3-2.21-8.24v-250.44c0-5.89,3.14-11.32,8.24-14.27L224.29,2.43c2.81-1.62,5.94-2.43,9.07-2.43h.01Z\" />\n      <path fill=\"#43413c\" d=\"M464.52,133.2c-1.42-2.46-3.48-4.56-6.03-6.03L242.43,2.43c-2.8-1.62-5.93-2.43-9.06-2.43v266.66l231.16,133.46c1.42-2.46,2.21-5.3,2.21-8.24v-250.44c0-2.95-.78-5.77-2.21-8.24h-.01Z\" />\n      <path fill=\"#d6d5d2\" d=\"M448.35,142.54c1.31,2.26,1.49,5.16,0,7.74l-209.83,363.42c-1.41,2.46-5.16,1.45-5.16-1.38v-239.48c0-1.91-.51-3.75-1.44-5.36l216.42-124.95h.01Z\" />\n      <path fill=\"#fff\" d=\"M448.35,142.54l-216.42,124.95c-.92-1.6-2.26-2.96-3.92-3.92L20.62,143.83c-2.46-1.41-1.45-5.16,1.38-5.16h419.65c2.98,0,5.4,1.61,6.7,3.87Z\" />\n    </svg>\n  );\n}\n\nfunction useSelectionEvents(\n  onOpen: (payload: SelectionPayload) => void,\n  onClose: () => void,\n  isOpen: boolean,\n) {\n  useEffect(() => {\n    const handler = (event: Event) => {\n      const custom = event as CustomEvent<SelectionPayload>;\n      if (!custom.detail) return;\n\n      if (isOpen) {\n        onClose();\n      }\n\n      onOpen(custom.detail);\n    };\n\n    window.addEventListener(EVENT_OPEN, handler as EventListener);\n    return () => window.removeEventListener(EVENT_OPEN, handler as EventListener);\n  }, [onOpen, onClose, isOpen]);\n}\n\nfunction useRecalculateRect(\n  chat: ChatState | null,\n  setChat: React.Dispatch<React.SetStateAction<ChatState | null>>,\n) {\n  useEffect(() => {\n    if (!chat) return;\n\n    const updateRect = () => {\n      const element = document.querySelector(HIGHLIGHT_QUERY);\n\n      if (!(element instanceof HTMLElement)) {\n        setChat((current) => {\n          if (!current || current.boundingRect === null) {\n            return current;\n          }\n          return { ...current, boundingRect: null };\n        });\n        return;\n      }\n\n      const rect = element.getBoundingClientRect();\n      const scrollX = window.scrollX;\n      const scrollY = window.scrollY;\n\n      const nextRect = {\n        top: rect.top + scrollY,\n        left: rect.left + scrollX,\n        width: rect.width,\n        height: rect.height,\n      };\n\n      setChat((current) => {\n        if (!current) {\n          return current;\n        }\n\n        const prev = current.boundingRect;\n        const hasChanged =\n          !prev ||\n          prev.top !== nextRect.top ||\n          prev.left !== nextRect.left ||\n          prev.width !== nextRect.width ||\n          prev.height !== nextRect.height;\n\n        if (!hasChanged) {\n          return current;\n        }\n\n        return {\n          ...current,\n          boundingRect: nextRect,\n        };\n      });\n    };\n\n    updateRect();\n    window.addEventListener(\"scroll\", updateRect, true);\n    window.addEventListener(\"resize\", updateRect);\n\n    return () => {\n      window.removeEventListener(\"scroll\", updateRect, true);\n      window.removeEventListener(\"resize\", updateRect);\n    };\n  }, [chat, setChat]);\n}\n\nfunction useEscapeToClose(isOpen: boolean, onClose: () => void) {\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handler = (event: KeyboardEvent) => {\n      if (event.key === \"Escape\") {\n        event.preventDefault();\n        onClose();\n      }\n    };\n\n    window.addEventListener(\"keydown\", handler, true);\n    return () => window.removeEventListener(\"keydown\", handler, true);\n  }, [isOpen, onClose]);\n}\n\nfunction useAutoFocus(isOpen: boolean) {\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const frame = requestAnimationFrame(() => {\n      const textarea = document.querySelector<HTMLTextAreaElement>(\n        \"[data-react-grab-chat-input='true']\",\n      );\n      textarea?.focus();\n      textarea?.select();\n    });\n\n    return () => cancelAnimationFrame(frame);\n  }, [isOpen]);\n}\n\nfunction useClickOutside(\n  ref: React.RefObject<HTMLElement | null>,\n  isOpen: boolean,\n  onClose: () => void,\n) {\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleClickOutside = (event: MouseEvent) => {\n      const target = event.target as Node;\n      if (ref.current && !ref.current.contains(target)) {\n        const highlightedElement = document.querySelector(HIGHLIGHT_QUERY);\n        if (!highlightedElement || !highlightedElement.contains(target)) {\n          onClose();\n        }\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside, true);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside, true);\n    };\n  }, [ref, isOpen, onClose]);\n}\n\nfunction Typewriter({ text }: { text: string }) {\n  const [displayed, setDisplayed] = useState(\"\");\n\n  useEffect(() => {\n    setDisplayed(\"\");\n    let i = 0;\n    const timer = setInterval(() => {\n      if (i < text.length) {\n        setDisplayed(text.slice(0, i + 1));\n        i++;\n      } else {\n        clearInterval(timer);\n      }\n    }, 15);\n    return () => clearInterval(timer);\n  }, [text]);\n\n  return <>{displayed}</>;\n}\n\nfunction Bubble({\n  chat,\n  onInstructionChange,\n  onSubmit,\n  onStop,\n  onModelChange,\n  onClose,\n  modelOptions,\n  statusSequence,\n}: {\n  chat: ChatState;\n  onInstructionChange: (value: string) => void;\n  onSubmit: () => void;\n  onStop: () => void;\n  onModelChange: (value: string) => void;\n  onClose: () => void;\n  modelOptions: readonly ModelOption[];\n  statusSequence: StatusSequence;\n}) {\n  const anchor = chat.boundingRect;\n  const bubbleRef = useRef<HTMLDivElement | null>(null);\n  const [bubbleSize, setBubbleSize] = useState<{ width: number; height: number } | null>(null);\n  const [bubbleStyle, setBubbleStyle] = useState<CSSProperties>(DEFAULT_BUBBLE_STYLE);\n  const textareaRef = useRef<HTMLTextAreaElement | null>(null);\n\n  useClickOutside(bubbleRef, true, onClose);\n\n  useLayoutEffect(() => {\n    const node = bubbleRef.current;\n    if (!node) return;\n\n    const updateSize = () => {\n      const rect = node.getBoundingClientRect();\n      setBubbleSize((prev) => {\n        if (prev && prev.width === rect.width && prev.height === rect.height) {\n          return prev;\n        }\n        return { width: rect.width, height: rect.height };\n      });\n    };\n\n    updateSize();\n\n    if (typeof ResizeObserver !== \"undefined\") {\n      const observer = new ResizeObserver(() => {\n        updateSize();\n      });\n      observer.observe(node);\n      return () => observer.disconnect();\n    }\n\n    window.addEventListener(\"resize\", updateSize);\n    return () => {\n      window.removeEventListener(\"resize\", updateSize);\n    };\n  }, []);\n\n  useLayoutEffect(() => {\n    if (!bubbleSize) {\n      setBubbleStyle((prev) => (prev === DEFAULT_BUBBLE_STYLE ? prev : DEFAULT_BUBBLE_STYLE));\n      return;\n    }\n\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n    const scrollX = window.scrollX;\n    const scrollY = window.scrollY;\n    const verticalGap = ANCHOR_GAP;\n    const horizontalGap = ANCHOR_GAP;\n\n    const clampHorizontal = (value: number) => {\n      const min = VIEWPORT_MARGIN;\n      const max = viewportWidth - VIEWPORT_MARGIN - bubbleSize.width;\n      if (min > max) {\n        return (viewportWidth - bubbleSize.width) / 2;\n      }\n      return Math.min(Math.max(value, min), max);\n    };\n\n    const clampVertical = (value: number) => {\n      const min = VIEWPORT_MARGIN;\n      const max = viewportHeight - VIEWPORT_MARGIN - bubbleSize.height;\n      if (min > max) {\n        return (viewportHeight - bubbleSize.height) / 2;\n      }\n      return Math.min(Math.max(value, min), max);\n    };\n\n    const computeOverflow = (top: number, left: number) => {\n      const overflowTop = Math.max(VIEWPORT_MARGIN - top, 0);\n      const overflowBottom = Math.max(\n        top + bubbleSize.height - (viewportHeight - VIEWPORT_MARGIN),\n        0,\n      );\n      const overflowLeft = Math.max(VIEWPORT_MARGIN - left, 0);\n      const overflowRight = Math.max(\n        left + bubbleSize.width - (viewportWidth - VIEWPORT_MARGIN),\n        0,\n      );\n\n      return overflowTop + overflowBottom + overflowLeft + overflowRight;\n    };\n\n    const pointer = chat.pointer;\n    let bestStyle: CSSProperties | null = null;\n\n    if (anchor) {\n      const anchorViewport = {\n        top: anchor.top - scrollY,\n        left: anchor.left - scrollX,\n        width: anchor.width,\n        height: anchor.height,\n      };\n\n      const anchorCenterX = anchorViewport.left + anchorViewport.width / 2;\n      const anchorCenterY = anchorViewport.top + anchorViewport.height / 2;\n\n      type CandidateName = \"bottom\" | \"top\" | \"right\" | \"left\";\n\n      type Candidate = {\n        name: CandidateName;\n        top: number;\n        left: number;\n        fits: boolean;\n        overflow: number;\n      };\n\n      const candidates: Candidate[] = [];\n\n      const bottomTop = anchorViewport.top + anchorViewport.height + verticalGap;\n      const bottomLeft = clampHorizontal(anchorCenterX - bubbleSize.width / 2);\n      candidates.push({\n        name: \"bottom\",\n        top: bottomTop,\n        left: bottomLeft,\n        fits: bottomTop + bubbleSize.height <= viewportHeight - VIEWPORT_MARGIN,\n        overflow: computeOverflow(bottomTop, bottomLeft),\n      });\n\n      const topTop = anchorViewport.top - verticalGap - bubbleSize.height;\n      const topLeft = clampHorizontal(anchorCenterX - bubbleSize.width / 2);\n      candidates.push({\n        name: \"top\",\n        top: topTop,\n        left: topLeft,\n        fits: topTop >= VIEWPORT_MARGIN,\n        overflow: computeOverflow(topTop, topLeft),\n      });\n\n      const rightLeft = anchorViewport.left + anchorViewport.width + horizontalGap;\n      const rightTop = clampVertical(anchorCenterY - bubbleSize.height / 2);\n      candidates.push({\n        name: \"right\",\n        top: rightTop,\n        left: rightLeft,\n        fits: rightLeft + bubbleSize.width <= viewportWidth - VIEWPORT_MARGIN,\n        overflow: computeOverflow(rightTop, rightLeft),\n      });\n\n      const leftLeft = anchorViewport.left - horizontalGap - bubbleSize.width;\n      const leftTop = clampVertical(anchorCenterY - bubbleSize.height / 2);\n      candidates.push({\n        name: \"left\",\n        top: leftTop,\n        left: leftLeft,\n        fits: leftLeft >= VIEWPORT_MARGIN,\n        overflow: computeOverflow(leftTop, leftLeft),\n      });\n\n      const baseOrder: CandidateName[] = [\"bottom\", \"top\", \"right\", \"left\"];\n      const orderedCandidates = baseOrder\n        .map((name) => candidates.find((candidate) => candidate.name === name))\n        .filter((candidate): candidate is Candidate => Boolean(candidate));\n\n      const perfectCandidate = orderedCandidates.find(\n        (candidate) => candidate.fits && candidate.overflow === 0,\n      );\n\n      if (perfectCandidate) {\n        bestStyle = {\n          top: `${Math.round(perfectCandidate.top + scrollY)}px`,\n          left: `${Math.round(perfectCandidate.left + scrollX)}px`,\n        };\n      } else if (!pointer) {\n        const bestCandidate =\n          orderedCandidates.find((candidate) => candidate.fits) ??\n          (orderedCandidates.length > 0\n            ? orderedCandidates.reduce(\n                (best, candidate) => (candidate.overflow < best.overflow ? candidate : best),\n                orderedCandidates[0],\n              )\n            : null);\n\n        if (bestCandidate) {\n          bestStyle = {\n            top: `${Math.round(bestCandidate.top + scrollY)}px`,\n            left: `${Math.round(bestCandidate.left + scrollX)}px`,\n          };\n        }\n      }\n    }\n\n    if (!bestStyle && pointer) {\n      const pointerTopRaw = pointer.y - POINTER_VERTICAL_OFFSET;\n      const clampedTop = clampVertical(pointerTopRaw);\n\n      const rightLeftRaw = pointer.x + POINTER_HORIZONTAL_GAP;\n      const fitsRight = rightLeftRaw + bubbleSize.width <= viewportWidth - VIEWPORT_MARGIN;\n\n      let targetLeft = rightLeftRaw;\n      if (!fitsRight) {\n        const leftLeftRaw = pointer.x - POINTER_HORIZONTAL_GAP - bubbleSize.width;\n        targetLeft = leftLeftRaw;\n      }\n\n      const clampedLeft = clampHorizontal(targetLeft);\n\n      bestStyle = {\n        top: `${Math.round(clampedTop + scrollY)}px`,\n        left: `${Math.round(clampedLeft + scrollX)}px`,\n      };\n    }\n\n    if (bestStyle) {\n      setBubbleStyle((prev) => {\n        if (\n          prev.top === bestStyle!.top &&\n          prev.left === bestStyle!.left &&\n          !(\"transform\" in prev)\n        ) {\n          return prev;\n        }\n        return bestStyle!;\n      });\n      return;\n    }\n\n    setBubbleStyle((prev) => (prev === DEFAULT_BUBBLE_STYLE ? prev : DEFAULT_BUBBLE_STYLE));\n  }, [anchor, bubbleSize, chat.pointer]);\n\n  const isSubmitting = chat.status === \"submitting\";\n  const hasInput = chat.instruction.trim().length > 0;\n  const showExpandedLayout = hasInput || chat.status !== \"idle\";\n  const disableEditing = isSubmitting;\n  const computedStatusLabel =\n    chat.statusLabel ?? statusSequence[chat.statusPhase] ?? statusSequence[0] ?? null;\n\n  const handleUndo = useCallback(() => {\n    if (chat.statusAddonMode !== \"summary\") {\n      return;\n    }\n\n    window.dispatchEvent(\n      new CustomEvent(EVENT_UNDO, {\n        detail: {\n          instruction: chat.instruction,\n          summary: chat.summary ?? null,\n          filePath: chat.filePath,\n        },\n      }),\n    );\n  }, [chat]);\n\n  useEffect(() => {\n    const textarea = textareaRef.current;\n    if (!textarea) return;\n\n    const minRows = showExpandedLayout ? 2 : 1;\n    textarea.rows = minRows;\n    textarea.style.height = \"auto\";\n    const computedStyles = window.getComputedStyle(textarea);\n    const lineHeight = parseFloat(computedStyles.lineHeight) || 24;\n    const borderOffset = textarea.offsetHeight - textarea.clientHeight;\n    const minHeight = lineHeight * minRows + borderOffset;\n    textarea.style.height = `${Math.max(textarea.scrollHeight, minHeight)}px`;\n  }, [chat.instruction, showExpandedLayout]);\n\n  const handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLTextAreaElement>) => {\n      if (event.key !== \"Enter\") return;\n      if (event.shiftKey) {\n        return;\n      }\n      event.preventDefault();\n      if (!isSubmitting && hasInput) {\n        onSubmit();\n      }\n    },\n    [hasInput, isSubmitting, onSubmit],\n  );\n\n  const handleChange = useCallback(\n    (event: ChangeEvent<HTMLTextAreaElement>) => {\n      onInstructionChange(event.target.value);\n    },\n    [onInstructionChange],\n  );\n\n  return (\n    <div\n      ref={bubbleRef}\n      className={cn(\n        \"absolute z-[2147483647] flex w-full max-w-[400px] flex-col overflow-hidden rounded-xl border border-neutral-200/40 bg-neutral-50/60 text-neutral-900 shadow-2xl backdrop-blur-2xl font-sans dark:border-neutral-700/40 dark:bg-neutral-900/60 dark:text-neutral-50\",\n        \"animate-in fade-in-0 zoom-in-95 duration-100 ease-out\",\n      )}\n      style={bubbleStyle}\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-label=\"Shipflow overlay request\"\n      data-react-grab-chat-bubble=\"true\"\n      data-react-grab=\"true\"\n    >\n      <div\n        className={cn(\n          \"flex w-full flex-col p-3\",\n          showExpandedLayout ? \"gap-2\" : \"gap-0\",\n        )}\n      >\n        <div className=\"relative flex w-full items-center gap-3\">\n          <textarea\n            ref={textareaRef}\n            data-react-grab-chat-input=\"true\"\n            rows={showExpandedLayout ? 2 : 1}\n            className={cn(\n              \"w-full resize-none bg-transparent text-sm font-normal leading-relaxed text-neutral-800 placeholder:text-neutral-400 outline-none dark:text-neutral-100 dark:placeholder:text-neutral-500\",\n              disableEditing && \"opacity-50\",\n              !showExpandedLayout && \"pr-10\",\n            )}\n            placeholder=\"Change anything\"\n            value={chat.instruction}\n            onChange={handleChange}\n            onKeyDown={handleKeyDown}\n            disabled={disableEditing}\n          />\n\n          {!showExpandedLayout ? (\n            <button\n              type=\"button\"\n              onClick={onSubmit}\n              disabled={!hasInput || isSubmitting}\n              className={cn(\n                \"absolute right-0 top-1/2 -translate-y-1/2 flex h-8 w-8 items-center justify-center rounded-full bg-neutral-300/50 text-neutral-600 transition hover:bg-neutral-300/80 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-neutral-700/50 dark:text-neutral-300 dark:hover:bg-neutral-700/80\",\n              )}\n            >\n              <ArrowUp className=\"h-4 w-4\" />\n            </button>\n          ) : null}\n        </div>\n\n        {showExpandedLayout ? (\n          <div className=\"flex items-center justify-between animate-in fade-in slide-in-from-top-1 duration-150 ease-out\">\n            <div className=\"relative inline-flex\">\n              <select\n                aria-label=\"Model selection\"\n                className={cn(\n                  \"h-8 w-auto appearance-none rounded-lg bg-neutral-200/50 pl-3 pr-[26px] text-xs font-medium text-neutral-500 transition hover:bg-neutral-200/70 focus:outline-none focus:ring-2 focus:ring-neutral-300/50 disabled:cursor-not-allowed disabled:opacity-60 dark:bg-neutral-800/50 dark:text-neutral-400 dark:hover:bg-neutral-800/70 dark:focus:ring-neutral-700/50\",\n                )}\n                value={chat.model}\n                onChange={(event) => onModelChange(event.target.value)}\n                disabled={disableEditing}\n              >\n                {modelOptions.map((option) => (\n                  <option key={option.value} value={option.value}>\n                    {option.label}\n                  </option>\n                ))}\n              </select>\n              <span className=\"pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-neutral-400 dark:text-neutral-500\">\n                <svg width=\"10\" height=\"6\" viewBox=\"0 0 10 6\" fill=\"none\">\n                  <path d=\"M1 1l4 4 4-4\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n                </svg>\n              </span>\n            </div>\n\n            <button\n              type=\"button\"\n              onClick={isSubmitting ? onStop : onSubmit}\n              disabled={!hasInput && !isSubmitting}\n              className={cn(\n                \"flex h-8 w-8 items-center justify-center rounded-full transition-all duration-200\",\n                isSubmitting\n                  ? \"bg-neutral-900 text-white hover:bg-neutral-800 dark:bg-white dark:text-black dark:hover:bg-neutral-200\"\n                  : \"bg-neutral-900 text-white shadow-lg hover:bg-neutral-800 hover:scale-105 dark:bg-white dark:text-black dark:hover:bg-neutral-200\",\n                !hasInput && !isSubmitting && \"opacity-0 pointer-events-none\",\n              )}\n            >\n              {isSubmitting ? (\n                <Square className=\"h-3 w-3 fill-current\" />\n              ) : (\n                <ArrowUp className=\"h-4 w-4\" />\n              )}\n            </button>\n          </div>\n        ) : null}\n      </div>\n\n      {chat.statusAddonMode !== \"idle\" && (\n        <div className=\"flex w-full flex-col border-t border-neutral-200/30 bg-neutral-100/30 px-3 py-2 backdrop-blur-xl dark:border-neutral-800/30 dark:bg-neutral-900/30 animate-in fade-in slide-in-from-top-1 duration-150 ease-out\">\n          {chat.statusAddonMode === \"progress\" ? (\n            <div className=\"flex items-center justify-between gap-3 text-xs font-medium\">\n              <div className=\"flex items-center gap-2 shrink-0\">\n                <CursorIcon className=\"h-3.5 w-3.5 animate-pulse-subtle\" />\n                <span className=\"bg-gradient-to-r from-neutral-600 via-neutral-600/40 to-neutral-600 bg-[length:200%_100%] bg-clip-text text-transparent animate-shimmer dark:from-neutral-400 dark:via-neutral-400/40 dark:to-neutral-400 opacity-60\">\n                  {computedStatusLabel}\n                </span>\n              </div>\n              {chat.statusContext && (\n                <span className=\"min-w-0 flex-1 truncate text-right text-neutral-400 dark:text-neutral-500\">\n                  {chat.useTypewriter ? <Typewriter text={chat.statusContext} /> : chat.statusContext}\n                </span>\n              )}\n            </div>\n          ) : chat.statusAddonMode === \"summary\" && chat.summary ? (\n            <div className=\"flex items-center justify-between text-xs font-medium\">\n              <div className=\"flex items-center gap-2 text-neutral-600 dark:text-neutral-400\">\n                <CursorIcon className=\"h-3.5 w-3.5\" />\n                <span>Changes applied</span>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <button\n                  type=\"button\"\n                  onClick={handleUndo}\n                  className=\"flex items-center gap-1 text-neutral-400 transition hover:text-neutral-900 dark:text-neutral-500 dark:hover:text-neutral-200\"\n                >\n                  Undo <Command className=\"h-3 w-3 ml-0.5\" /> Z\n                </button>\n              </div>\n            </div>\n          ) : null}\n        </div>\n      )}\n\n      {chat.error ? (\n        <div className=\"border-t border-red-200/50 bg-red-50/50 px-3 py-2 text-xs font-medium text-red-600 backdrop-blur-xl dark:border-red-500/30 dark:bg-red-500/10 dark:text-red-200\">\n          {chat.error}\n        </div>\n      ) : null}\n    </div>\n  );\n}\n\nexport function FlowOverlayProvider(props: FlowOverlayProps = {}) {\n  const clipboardOptions = useMemo(\n    () => props.clipboardOptions ?? {},\n    [props.clipboardOptions],\n  );\n\n  const config = useMemo<ShipflowOverlayConfig>(() => {\n    const models =\n      props.models && props.models.length > 0 ? props.models : DEFAULT_CONFIG.models;\n    const statusSequence =\n      props.statusSequence && props.statusSequence.length > 0\n        ? props.statusSequence\n        : DEFAULT_CONFIG.statusSequence;\n    const endpoint = props.endpoint ?? DEFAULT_CONFIG.endpoint;\n\n    return {\n      endpoint,\n      models,\n      statusSequence,\n    };\n  }, [props.endpoint, props.models, props.statusSequence]);\n\n  const [chat, setChat] = useState<ChatState | null>(null);\n  const abortControllerRef = useRef<AbortController | null>(null);\n  const fallbackStatusLabel = config.statusSequence[0] ?? null;\n\n  useEffect(() => {\n    if (props.enableClipboardInterceptor === false) {\n      return;\n    }\n\n    let cleanup: (() => void) | undefined;\n\n    loadReactGrabRuntime({\n      url: clipboardOptions.reactGrabUrl,\n    })\n      .then(() => {\n        cleanup = registerClipboardInterceptor({\n          projectRoot: clipboardOptions.projectRoot,\n          highlightColor: clipboardOptions.highlightColor,\n          highlightStyleId: clipboardOptions.highlightStyleId,\n          logClipboardEndpoint:\n            clipboardOptions.logClipboardEndpoint ??\n            process.env.SHIPFLOW_OVERLAY_LOG_ENDPOINT ??\n            null,\n          reactGrabUrl: clipboardOptions.reactGrabUrl,\n        });\n      })\n      .catch((error) => {\n        console.error(\"[shipflow-overlay] Failed to load React Grab runtime\", error);\n      });\n\n    return () => {\n      cleanup?.();\n    };\n  }, [\n    clipboardOptions.highlightColor,\n    clipboardOptions.highlightStyleId,\n    clipboardOptions.logClipboardEndpoint,\n    clipboardOptions.projectRoot,\n    clipboardOptions.reactGrabUrl,\n    props.enableClipboardInterceptor,\n  ]);\n\n  const close = useCallback(() => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n      abortControllerRef.current = null;\n    }\n    setChat(null);\n    window.dispatchEvent(new Event(EVENT_CLOSE));\n  }, []);\n\n  const buildInitialState = useCallback(\n    () => createInitialState(config.models, config.statusSequence),\n    [config.models, config.statusSequence],\n  );\n\n  useSelectionEvents(\n    useCallback(\n      (payload: SelectionPayload) => {\n        setChat({\n          ...buildInitialState(),\n          ...payload,\n        });\n      },\n      [buildInitialState],\n    ),\n    close,\n    Boolean(chat),\n  );\n\n  useRecalculateRect(chat, setChat);\n  useEscapeToClose(Boolean(chat), close);\n  useAutoFocus(Boolean(chat));\n\n  const sendToBackend = useCallback(\n    async (payload: {\n      filePath: string | null;\n      htmlFrame: string | null;\n      stackTrace: string | null;\n      instruction: string;\n      model: string;\n    }) => {\n      const controller = new AbortController();\n      abortControllerRef.current = controller;\n\n      const promotePhase = (phase: number) => {\n        const safePhase = Math.min(Math.max(phase, 0), config.statusSequence.length - 1);\n        setChat((prev) => {\n          if (!prev) return prev;\n          if (prev.statusPhase === safePhase && prev.statusLabel) {\n            return prev;\n          }\n          return {\n            ...prev,\n            statusPhase: safePhase,\n            statusLabel: config.statusSequence[safePhase] ?? fallbackStatusLabel,\n          };\n        });\n      };\n\n      try {\n        const response = await fetch(config.endpoint, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          signal: controller.signal,\n          body: JSON.stringify(payload),\n        });\n\n        if (!response.ok) {\n          const data = await response.json().catch(() => null);\n          throw new Error(data?.error ?? `Request failed with status ${response.status}`);\n        }\n\n        const reader = response.body?.getReader();\n        if (!reader) {\n          throw new Error(\"Streaming response is not supported in this environment.\");\n        }\n\n        const decoder = new TextDecoder();\n        let buffer = \"\";\n        let assistantSummary = \"\";\n        let hasPromotedPlanning = false;\n        let hasPromotedUpdating = false;\n\n        const processEvent = (event: StreamEvent) => {\n          if (event.event === \"status\") {\n            const message = event.message?.trim();\n            if (message) {\n              if (!hasPromotedPlanning && /plan|analy/i.test(message)) {\n                promotePhase(1);\n                hasPromotedPlanning = true;\n              }\n              if (!hasPromotedUpdating && /apply|build|final|update/i.test(message)) {\n                promotePhase(2);\n                hasPromotedUpdating = true;\n              }\n              setChat((prev) =>\n                prev\n                  ? {\n                      ...prev,\n                      statusContext: message,\n                      useTypewriter: true,\n                    }\n                  : prev,\n              );\n            }\n            if (!hasPromotedPlanning) {\n              promotePhase(0);\n            }\n            return;\n          }\n\n          if (event.event === \"assistant\") {\n            const chunk = event.text?.trim();\n            if (chunk) {\n              assistantSummary += chunk.endsWith(\"\\n\") ? chunk : `${chunk} `;\n              if (!hasPromotedPlanning) {\n                promotePhase(1);\n                hasPromotedPlanning = true;\n              }\n              setChat((prev) =>\n                prev\n                  ? {\n                      ...prev,\n                      statusContext: chunk,\n                      useTypewriter: false,\n                    }\n                  : prev,\n              );\n            }\n            return;\n          }\n\n          if (event.event === \"done\") {\n            if (event.success) {\n              promotePhase(2);\n              hasPromotedUpdating = true;\n              const summary =\n                event.summary?.trim() || assistantSummary.trim() || \"Changes applied.\";\n              setChat((prev) =>\n                prev\n                  ? {\n                      ...prev,\n                      status: \"success\",\n                      instruction: \"\",\n                      statusAddonMode: \"summary\",\n                      summary,\n                      statusLabel: null,\n                      statusContext: null,\n                      statusPhase: Math.max(config.statusSequence.length - 1, 0),\n                      serverMessage: event.stderr ? event.stderr.trim() : prev.serverMessage,\n                    }\n                  : prev,\n              );\n            } else {\n              setChat((prev) =>\n                prev\n                  ? {\n                      ...prev,\n                      status: \"error\",\n                      error: event.error ?? \"Cursor CLI reported an error.\",\n                      statusAddonMode: \"idle\",\n                      statusLabel: null,\n                      statusContext: null,\n                      summary: undefined,\n                      statusPhase: 0,\n                      serverMessage: event.stderr ? event.stderr.trim() : prev.serverMessage,\n                    }\n                  : prev,\n              );\n            }\n          }\n        };\n\n        while (true) {\n          const { done, value } = await reader.read();\n          if (done) {\n            break;\n          }\n\n          buffer += decoder.decode(value, { stream: true });\n          let newlineIndex = buffer.indexOf(\"\\n\");\n\n          while (newlineIndex !== -1) {\n            const line = buffer.slice(0, newlineIndex).trim();\n            buffer = buffer.slice(newlineIndex + 1);\n            if (line) {\n              try {\n                processEvent(JSON.parse(line) as StreamEvent);\n              } catch (error) {\n                console.warn(\"[shipflow-overlay] Unable to parse stream line\", { line, error });\n              }\n            }\n            newlineIndex = buffer.indexOf(\"\\n\");\n          }\n        }\n\n        buffer += decoder.decode();\n        const finalLine = buffer.trim();\n        if (finalLine) {\n          try {\n            processEvent(JSON.parse(finalLine) as StreamEvent);\n          } catch (error) {\n            console.warn(\"[shipflow-overlay] Unable to parse final stream line\", { finalLine, error });\n          }\n        }\n      } catch (error) {\n        if (controller.signal.aborted) {\n          setChat((prev) =>\n            prev\n              ? {\n                  ...prev,\n                  status: \"idle\",\n                  statusAddonMode: \"idle\",\n                  statusLabel: null,\n                  statusContext: null,\n                  summary: undefined,\n                  error: undefined,\n                  serverMessage: undefined,\n                  statusPhase: 0,\n                }\n              : prev,\n          );\n          return;\n        }\n\n        console.error(\"[shipflow-overlay] Failed to communicate with Cursor CLI backend\", error);\n        setChat((prev) =>\n          prev\n            ? {\n                ...prev,\n                status: \"error\",\n                error: error instanceof Error ? error.message : \"Unable to send request.\",\n                statusAddonMode: \"idle\",\n                statusLabel: null,\n                statusContext: null,\n                summary: undefined,\n              }\n            : prev,\n        );\n      } finally {\n        if (abortControllerRef.current === controller) {\n          abortControllerRef.current = null;\n        }\n      }\n    },\n    [config.endpoint, config.models, config.statusSequence, fallbackStatusLabel],\n  );\n\n  const onInstructionChange = useCallback((value: string) => {\n    setChat((current) => {\n      if (!current) {\n        return current;\n      }\n\n      const next: ChatState = {\n        ...current,\n        instruction: value,\n      };\n\n      if (current.status !== \"submitting\") {\n        next.status = \"idle\";\n      }\n\n      if (value.length > 0 && current.statusAddonMode !== \"idle\") {\n        next.statusAddonMode = \"idle\";\n        next.statusLabel = null;\n        next.statusContext = null;\n        next.summary = undefined;\n        next.statusPhase = 0;\n      }\n\n      if (current.status === \"error\") {\n        next.error = undefined;\n      }\n\n      return next;\n    });\n  }, []);\n\n  const onSubmit = useCallback(() => {\n    let payload:\n      | {\n          filePath: string | null;\n          htmlFrame: string | null;\n          stackTrace: string | null;\n          instruction: string;\n          model: string;\n        }\n      | null = null;\n\n    setChat((current) => {\n      if (!current) return current;\n      if (current.status === \"submitting\") return current;\n\n      const trimmed = current.instruction.trim();\n      if (!trimmed) {\n        return {\n          ...current,\n          error: \"Please describe the change.\",\n          status: \"error\",\n          statusAddonMode: \"idle\",\n          statusLabel: null,\n          statusContext: null,\n          summary: undefined,\n          statusPhase: 0,\n          serverMessage: undefined,\n        };\n      }\n\n      payload = {\n        filePath: current.filePath,\n        htmlFrame: current.htmlFrame,\n        stackTrace: current.codeLocation,\n        instruction: trimmed,\n        model: current.model || config.models[0]?.value || \"\",\n      };\n\n      return {\n        ...current,\n        instruction: trimmed,\n        status: \"submitting\",\n        error: undefined,\n        serverMessage: undefined,\n        statusAddonMode: \"progress\",\n        statusLabel: config.statusSequence[0] ?? fallbackStatusLabel,\n        statusContext: \"Preparing Cursor CLI requestâ€¦\",\n        summary: undefined,\n        statusPhase: 0,\n      };\n    });\n\n    if (payload) {\n      void sendToBackend(payload);\n    }\n  }, [config.models, config.statusSequence, fallbackStatusLabel, sendToBackend]);\n\n  const stop = useCallback(() => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n    }\n  }, []);\n\n  const onModelChange = useCallback(\n    (value: string) => {\n      setChat((current) => {\n        if (!current || current.status === \"submitting\") {\n          return current;\n        }\n        const nextValue = config.models.some((option) => option.value === value)\n          ? value\n          : config.models[0]?.value ?? \"\";\n        return { ...current, model: nextValue };\n      });\n    },\n    [config.models],\n  );\n\n  const bubble = chat ? (\n    <Bubble\n      chat={chat}\n      onInstructionChange={onInstructionChange}\n      onSubmit={onSubmit}\n      onStop={stop}\n      onModelChange={onModelChange}\n      onClose={close}\n      modelOptions={config.models}\n      statusSequence={config.statusSequence}\n    />\n  ) : null;\n\n  if (!bubble) return null;\n\n  return createPortal(bubble, document.body);\n}\n\nexport { Typewriter };\n","import { clsx, type ClassValue } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n","export const DEFAULT_STATUS_SEQUENCE = [\n  \"Thinking\",\n  \"Planning next moves\",\n  \"Updating UI\",\n] as const;\n\nexport const DEFAULT_MODEL_OPTIONS = [\n  { value: \"composer-1\", label: \"Composer 1\" },\n  { value: \"gpt-5\", label: \"GPT-5\" },\n  { value: \"sonnet-4.5\", label: \"Sonnet 4.5\" },\n  { value: \"gemini-3\", label: \"Gemini 3\" },\n] as const;\n"],"mappings":"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","names":["_a","_b"]}